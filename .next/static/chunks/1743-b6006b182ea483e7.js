"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1743],{35695:(e,t,a)=>{var o=a(18999);a.o(o,"useParams")&&a.d(t,{useParams:function(){return o.useParams}}),a.o(o,"usePathname")&&a.d(t,{usePathname:function(){return o.usePathname}}),a.o(o,"useRouter")&&a.d(t,{useRouter:function(){return o.useRouter}})},40963:(e,t,a)=>{a.d(t,{n:()=>d,d:()=>u});var o=a(95155),r=a(12115),n=a(35726),l=a(9665);let i=e=>{let{open:t,message:a,severity:r="info",duration:i=2e3,onClose:s}=e;return(0,o.jsx)(n.A,{open:t,autoHideDuration:i,onClose:s,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,o.jsx)(l.A,{onClose:s,severity:r,variant:"filled",children:a})})},s=(0,r.createContext)(void 0),d=e=>{let{children:t}=e,[a,n]=(0,r.useState)({open:!1,message:"",severity:"info",duration:2e3,onClose:void 0});return(0,o.jsxs)(s.Provider,{value:{showSnackbar:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;n({open:!0,message:e,severity:t,duration:a,onClose:o})}},children:[t,(0,o.jsx)(i,{open:a.open,message:a.message,severity:a.severity,duration:a.duration,onClose:()=>{n(e=>({...e,open:!1})),a.onClose&&a.onClose()}})]})},u=()=>{let e=(0,r.useContext)(s);if(!e)throw Error("useSnackbar must be used within a SnackbarProvider");return e}},81743:(e,t,a)=>{a.d(t,{A:()=>b});var o=a(95155),r=a(12115),n=a(14426),l=a(94573),i=a(68534),s=a(864),d=a(56278),u=a(54492),c=a(99927),p=a(71977),m=a(38464);let h=(0,a(57515).A)((0,o.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumbered");var g=a(28890),f=a(76408),x=a(35695),v=a(40963),y=a(23464);function b(e){let{productId:t,isViewMode:a=!1}=e,b=(0,x.useRouter)(),{showSnackbar:_}=(0,v.d)(),[k,j]=(0,r.useState)({}),[S,w]=(0,r.useState)({}),[A,C]=(0,r.useState)(!1),[N,z]=(0,r.useState)(!1),[O,E]=(0,r.useState)({product_name:[],product_size:[]}),[P,I]=(0,r.useState)(!1),[F,H]=(0,r.useState)(null),[U,T]=(0,r.useState)(""),[B,J]=(0,r.useState)({}),[V,q]=(0,r.useState)(!1),[W,D]=(0,r.useState)(null),L=!!t,[R,M]=(0,r.useState)([]);(0,r.useEffect)(()=>{L&&t&&R.length>0&&G()},[L,t,R]);let G=async()=>{z(!0);try{let e=localStorage.getItem("user"),a=e?JSON.parse(e):null;if(!(null==a?void 0:a.companyuuid))return void console.error("Company UUID not found in localStorage user");let o=localStorage.getItem("token");if(!o)return void console.error("Auth token not found. Please login again.");let r=(await y.A.get("/api/protected/get-single-product",{params:{product_uuid:t},headers:{"Content-Type":"application/json","x-auth-token":"Bearer ".concat(o)}})).data;if(r.status&&r.data&&r.data.length>0){let e=r.data[0],t={};R.forEach(a=>{var o;t[a.key]=void 0!==e[a.key]?String(null!=(o=e[a.key])?o:""):""}),j(t),J({product_name:t.product_name||"",product_size:t.product_size||""})}}catch(e){console.error("Error fetching product data:",e),_("Failed to fetch product data","error",4e3)}finally{z(!1)}},K=(e,t)=>{j(a=>({...a,[e]:t})),w(t=>({...t,[e]:""}))},Q=(e,t)=>{H(e),T(t),I(!0)};(0,r.useEffect)(()=>{["product_name","product_size"].forEach(async e=>{let t=await Y(e);E(a=>({...a,[e]:t}))})},[]);let X=async()=>{if(F&&U.trim()){let e=!1;if(V&&W?await $(F,W,U.trim()):await Z(F,U.trim())){let e=await Y(F);E(t=>({...t,[F]:e})),j(e=>({...e,[F]:U.trim()}))}I(!1),q(!1),D(null)}},Y=async e=>{let t=localStorage.getItem("user"),a=t?JSON.parse(t):null,o=null==a?void 0:a.companyuuid,r=localStorage.getItem("token");if(!o||!r)return[];let n="/api/protected/".concat("product_name"===e?"product-name":"product-size","?company_uuid=").concat(o);try{var l,i;return(null==(i=(await y.A.get(n,{headers:{"x-auth-token":"Bearer ".concat(r)}})).data)||null==(l=i.data)?void 0:l.map(t=>({label:t[e],value:t[e],uuid:t["".concat(e,"_uuid")]||t.product_name_uuid||t.product_size_uuid||""})))||[]}catch(t){return console.error("Failed to fetch ".concat(e," options:"),t),[]}},Z=async(e,t)=>{let a=localStorage.getItem("user"),o=a?JSON.parse(a):null,r=null==o?void 0:o.companyuuid,n=localStorage.getItem("token");if(!r||!n)return!1;let l="/api/protected/".concat("product_name"===e?"product-name":"product-size","?company_uuid=").concat(r);try{return await y.A.post(l,{[e]:t},{headers:{"x-auth-token":"Bearer ".concat(n)}}),_("Added new ".concat(e),"success",2e3),!0}catch(t){return console.error("Failed to add ".concat(e,":"),t),_("Failed to add ".concat(e),"error",3e3),!1}},$=async(e,t,a)=>{let o=localStorage.getItem("user"),r=o?JSON.parse(o):null,n=null==r?void 0:r.companyuuid,l=localStorage.getItem("token");if(!n||!l)return!1;let i="",s={};"product_name"===e?(i="/api/protected/product-name?product_uuid=".concat(t),s={product_name_uuid:t,product_name:a}):(i="/api/protected/product-size?company_uuid=".concat(n),s={product_size_uuid:t,product_size:a});try{return await y.A.put(i,s,{headers:{"x-auth-token":"Bearer ".concat(l)}}),_("Updated ".concat(e),"success",2e3),!0}catch(t){return console.error("Failed to update ".concat(e,":"),t),_("Failed to update ".concat(e),"error",3e3),!1}},ee=async e=>{let a,o=localStorage.getItem("user"),r=o?JSON.parse(o):null,n=null==r?void 0:r.companyuuid;if(!n)throw Error("Company UUID not found in localStorage user");let l={product_name:e.product_name,product_category:e.product_category,product_size:e.product_size,product_series:e.product_series,product_finish:e.product_finish,product_pieces_per_box:e.product_pieces_per_box,product_weight:e.product_weight,product_sq_ft_box:e.product_sq_ft_box},i=L?"/api/protected/create-product?product_uuid=".concat(t):"/api/protected/create-product?company_uuid=".concat(n),s=localStorage.getItem("token");if(!s)throw Error("Token not found in localStorage");if(!(a=L?await y.A.put(i,l,{headers:{"Content-Type":"application/json","x-auth-token":"Bearer ".concat(s)}}):await y.A.post(i,l,{headers:{"Content-Type":"application/json","x-auth-token":"Bearer ".concat(s)}})).data||!a.data.status){var d;throw Error((null==(d=a.data)?void 0:d.message)||"Failed to ".concat(L?"update":"create"," product"))}return a.data},et=async e=>{e.preventDefault();let t={},a=!1;if(R.forEach(e=>{k[e.key]||(t[e.key]="".concat(e.label," is required"),a=!0)}),w(t),a)_("Please fix the validation errors","error",4e3);else{C(!0);try{let e=await ee(k);e.status?(_(e.msg,"success",3e3),b.push("/user/products"),L||(j({}),J({}))):_(e.msg,"error",3e3)}catch(e){_(e instanceof Error?e.message:"Unexpected error occurred.","error",3e3)}finally{C(!1)}}};return((0,r.useEffect)(()=>{let e=localStorage.getItem("quotation_product_fields");if(e)try{let t=JSON.parse(e);M(Object.entries(t).map(e=>{let[t,a]=e;return{key:t,label:String(a)}}))}catch(e){console.error("Failed to parse fields from localStorage:",e),M([])}},[]),N)?(0,o.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,o.jsx)(n.A,{})}):(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-6 lg:p-8",children:(0,o.jsx)("div",{className:"max-w-3xl mx-auto",children:(0,o.jsxs)(f.P.div,{children:[(0,o.jsxs)("button",{type:"button",className:"flex items-center gap-2 text-indigo-600 hover:text-indigo-800 font-semibold mb-4",onClick:()=>b.back(),children:[(0,o.jsx)(m.A,{fontSize:"small"}),"Back"]}),(0,o.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-6 sm:p-8",children:[(0,o.jsxs)("div",{className:"text-center mb-8",children:[(0,o.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,o.jsx)(h,{className:"w-8 h-8 text-white"})}),(0,o.jsx)("h1",{className:"text-2xl sm:text-2xl font-bold text-gray-900 mb-2",children:L?"Edit Product":"Add New Product"})]}),(0,o.jsxs)("form",{onSubmit:et,className:"space-y-6",children:[(0,o.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:R.map(e=>{let t="product_name"===e.key||"product_size"===e.key,n=k[e.key]||"",d=(O[e.key]||[]).map(e=>"isAddOption"in e&&e.isAddOption?e:{label:e.label,value:"value"in e?e.value:"",uuid:"uuid"in e?e.uuid:""});return(0,o.jsx)("div",{className:"space-y-2",children:t?(0,o.jsx)(l.A,{value:d.find(e=>"value"in e&&e.value===n)||null,onChange:(t,a)=>{a&&"isAddOption"in a&&a.isAddOption?Q(e.key,B[e.key]||""):a&&"value"in a?K(e.key,a.value):K(e.key,"")},inputValue:B[e.key]||"",onInputChange:(t,a)=>{J(t=>({...t,[e.key]:a}))},options:d,filterOptions:e=>e.some(e=>"isAddOption"in e&&e.isAddOption)?e:[...e,{label:"Add",isAddOption:!0}],getOptionLabel:e=>e&&"object"==typeof e&&"label"in e&&e.label?String(e.label):"",isOptionEqualToValue:(e,t)=>"value"in e&&"value"in t&&e.value===t.value,disabled:a,renderOption:(t,a)=>{if("isAddOption"in a&&a.isAddOption)return(0,r.createElement)("li",{...t,key:"add-option"},(0,o.jsx)(i.A,{variant:"outlined",color:"primary",fullWidth:!0,children:a.label}));{if(!a.label||!("value"in a)||!a.value)return null;let n=a.uuid||a.value||a.label;return(0,r.createElement)("li",{...t,key:n,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.label,(0,o.jsx)(i.A,{size:"small",onClick:t=>{t.stopPropagation(),H(e.key),T(a.label),q(!0),!("isAddOption"in a&&a.isAddOption)&&"uuid"in a?D(a.uuid):D(null),I(!0)},children:(0,o.jsx)(g.A,{fontSize:"small"})})]})}},renderInput:t=>(0,o.jsx)(s.A,{...t,label:e.label,variant:"outlined",size:"small",error:!!S[e.key],helperText:S[e.key]})}):(0,o.jsx)(s.A,{fullWidth:!0,size:"small",label:e.label,value:n,onChange:t=>K(e.key,t.target.value),error:!!S[e.key],helperText:S[e.key],disabled:a})},e.key)})}),!a&&(0,o.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-3 sm:gap-4 pt-6 sm:pt-8",children:[(0,o.jsx)(f.P.button,{type:"button",onClick:()=>{L?b.back():(j({}),J({}),w({}),_("Form cleared","info",2e3))},whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 sm:px-6 py-2.5 sm:py-3 text-sm bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-300 transition-all duration-200 shadow-md hover:shadow-lg",children:L?"Cancel":"Clear"}),(0,o.jsx)(f.P.button,{type:"submit",whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 sm:px-6 py-2.5 sm:py-3 text-sm bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-lg hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg",disabled:A,children:A?(0,o.jsx)(n.A,{size:22,color:"inherit"}):L?"Update":"Submit"})]})]}),(0,o.jsxs)(d.A,{open:P,onClose:()=>{I(!1),F&&J(e=>({...e,[F]:""}))},fullWidth:!0,maxWidth:"xs",PaperProps:{className:"rounded-2xl",style:{boxShadow:"0 8px 32px rgba(80, 80, 180, 0.15)"}},children:[(0,o.jsx)(u.A,{className:"font-bold text-indigo-700",children:V?"Edit ".concat(null==F?void 0:F.toUpperCase()):"Add New ".concat(null==F?void 0:F.toUpperCase())}),(0,o.jsx)(c.A,{children:(0,o.jsx)(s.A,{fullWidth:!0,autoFocus:!0,label:"New Value",value:U,onChange:e=>T(e.target.value),sx:{mt:1}})}),(0,o.jsxs)(p.A,{children:[(0,o.jsx)(i.A,{onClick:()=>{I(!1),F&&J(e=>({...e,[F]:""}))},variant:"outlined",color:"secondary",children:"Cancel"}),(0,o.jsx)(i.A,{onClick:X,variant:"contained",disabled:!U.trim(),sx:{background:"linear-gradient(to right, #6366f1, #a21caf)"},children:V?"Update":"Add"})]})]})]})]})})})}}}]);