(()=>{var e={};e.id=4120,e.ids=[4120],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30193:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{patchFetch:()=>i,routeModule:()=>d,serverHooks:()=>p,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>l});var o=s(96559),u=s(48088),a=s(37719),n=s(78380),c=e([n]);n=(c.then?(await c)():c)[0];let d=new o.AppRouteRouteModule({definition:{kind:u.RouteKind.APP_ROUTE,page:"/api/protected/create-customer/route",pathname:"/api/protected/create-customer",filename:"route",bundlePath:"app/api/protected/create-customer/route"},resolvedPagePath:"D:\\ct-quotation\\src\\app\\api\\protected\\create-customer\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:m,workUnitAsyncStorage:l,serverHooks:p}=d;function i(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:l})}r()}catch(e){r(e)}})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},62484:(e,t,s)=>{"use strict";s.d(t,{E:()=>o,b:()=>u});var r=s(85663);let o=async e=>{let t=await r.Ay.genSalt(10);return r.Ay.hash(e,t)},u=(e,t)=>r.Ay.compare(e,t)},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{"use strict";e.exports=import("pg")},78335:()=>{},78380:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{GET:()=>d,POST:()=>c,PUT:()=>i});var o=s(32190),u=s(94447),a=s(62484),n=e([u]);async function c(e){try{let t=e.headers.get("x-user-uuid");if(!t)return o.NextResponse.json({status:!1,msg:"Unauthorized access"},{status:401});let{searchParams:s}=new URL(e.url),r=s.get("company_uuid"),n=await e.json();(Array.isArray(n.module)?n.module:[]).forEach(e=>{"string"==typeof e&&(n[e]=!0)}),n.customer_password=await (0,a.E)(n.customer_password),n.customer_role=1,n.company_uuid=r,n.created_by_admin=t;let c=await (0,u.SI)(n);return o.NextResponse.json({status:c.status,msg:c.msg,data:c.data},{status:c.status?200:400})}catch(e){if(console.error("Registration error:",e),e instanceof Error&&e.code){if("23505"===e.code)return o.NextResponse.json({status:!1,msg:"Email or mobile already linked with another user"},{status:400});return o.NextResponse.json({status:!1,msg:"Internal Server Error",error:e},{status:500})}}}async function i(e){try{if(!e.headers.get("x-user-uuid"))return o.NextResponse.json({status:!1,msg:"Unauthorized access"},{status:401});let{searchParams:t}=new URL(e.url),s=t.get("customer_uuid"),r=await e.json();(Array.isArray(r.module)?r.module:[]).forEach(e=>{"string"==typeof e&&(r[e]=!0)}),r.customer_password&&(r.customer_password=await (0,a.E)(r.customer_password)),r.customer_uuid=s;let n=await (0,u.Gk)(r);return o.NextResponse.json({status:n.status,msg:n.msg,data:n.data},{status:n.status?200:400})}catch(e){if(console.error("Updation error:",e),e instanceof Error&&e.code){if("23505"===e.code)return o.NextResponse.json({status:!1,msg:"Email or mobile already linked with another user"},{status:400});return o.NextResponse.json({status:!1,msg:"Internal Server Error",error:e},{status:500})}}}async function d(e){try{if(!e.headers.get("x-user-uuid"))return o.NextResponse.json({status:!1,msg:"Unauthorized access"},{status:401});let{searchParams:t}=new URL(e.url),s=t.get("customer_uuid"),r=await (0,u.xt)(String(s));return o.NextResponse.json({status:r.status,msg:r.msg,data:r.data},{status:r.status?200:400})}catch(e){if(console.error("Updation error:",e),e instanceof Error&&e.code){if("23505"===e.code)return o.NextResponse.json({status:!1,msg:"Email or mobile already linked with another user"},{status:400});return o.NextResponse.json({status:!1,msg:"Internal Server Error",error:e},{status:500})}}}u=(n.then?(await n)():n)[0],r()}catch(e){r(e)}})},94447:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.d(t,{Gk:()=>n,SI:()=>a,xt:()=>c});var o=s(96364),u=e([o]);o=(u.then?(await u)():u)[0];let a=async e=>{let t=`
    INSERT INTO customers (
      customer_name,
      customer_email,
      customer_password,
      customer_country_code,
      customer_mobile,
      customer_role,
      quotation_module,
      bussiness_card_module,
      created_by_admin,
      company_uuid
    ) VALUES (
      $1, $2, $3, $4, $5, $6, $7, $8, $9,$10
    )
    RETURNING customer_uuid
  `;console.log(e),console.log(e.customer_password);let s=[e.customer_name,e.customer_email,e.customer_password,e.customer_country_code??"+91",e.customer_mobile,e.customer_role??null,e.quotation_module??!1,e.bussiness_card_module??!1,e.created_by_admin??null,e.company_uuid],r=await o.d.query(t,s);return 0===r.rowCount?{msg:"Customer not created",code:400,status:!1}:{msg:"Customer registered successfully",code:200,status:!0,data:r.rows[0]}},n=async e=>{console.log(e.bussiness_card_module);let t=`
    UPDATE customers SET
      customer_name = $1,
      customer_email = $2,
      customer_country_code = $3,
      customer_mobile = $4,
      customer_role = $5,
      quotation_module = $6,
      bussiness_card_module = $7`,s=[e.customer_name??null,e.customer_email??null,e.customer_country_code??"+91",e.customer_mobile??null,e.customer_role??1,e.quotation_module??!1,!1],r=s.length+1;null!=e.customer_password&&void 0!=e.customer_password&&(t+=`,customer_password=$${r}`,s.push(e.customer_password),r+=1),null!=e.status&&void 0!=e.status&&(t+=`,status=$${r}`,s.push(e.status),r+=1),t+=` WHERE customer_uuid = $${r}
    RETURNING customer_uuid`,s.push(e.customer_uuid);let u=await o.d.query(t,s);return 0===u.rowCount?{msg:"Customer not found or update failed",code:404,status:!1}:{msg:"Customer updated successfully",code:200,status:!0,data:{customer_uuid:u.rows[0].customer_uuid}}},c=async e=>{let t=`
    select * from customers
    WHERE customer_uuid = $1
  `;try{let s=await o.d.query(t,[e]);if(0===s.rowCount)return{msg:"Customer not found ",code:404,status:!1};return{msg:"Customer get successfully",code:200,status:!0,data:s.rows}}catch(e){return console.error("Error updating customer:",e),{msg:"Database error occurred",code:500,status:!1,error:e}}};r()}catch(e){r(e)}})},96364:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.d(t,{d:()=>a});var o=s(64939),u=e([o]);let a=new(o=(u.then?(await u)():u)[0]).Pool({user:process.env.DB_USER,host:process.env.DB_HOST,database:process.env.DB_NAME,password:process.env.DB_PASSWORD,port:5432,ssl:{rejectUnauthorized:!1}});r()}catch(e){r(e)}})},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[4447,580,5663],()=>s(30193));module.exports=r})();