"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9443],{40963:(e,a,r)=>{r.d(a,{n:()=>d,d:()=>u});var s=r(95155),t=r(12115),l=r(35726),o=r(9665);let n=e=>{let{open:a,message:r,severity:t="info",duration:n=2e3,onClose:i}=e;return(0,s.jsx)(l.A,{open:a,autoHideDuration:n,onClose:i,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,s.jsx)(o.A,{onClose:i,severity:t,variant:"filled",children:r})})},i=(0,t.createContext)(void 0),d=e=>{let{children:a}=e,[r,l]=(0,t.useState)({open:!1,message:"",severity:"info",duration:2e3,onClose:void 0});return(0,s.jsxs)(i.Provider,{value:{showSnackbar:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;l({open:!0,message:e,severity:a,duration:r,onClose:s})}},children:[a,(0,s.jsx)(n,{open:r.open,message:r.message,severity:r.severity,duration:r.duration,onClose:()=>{l(e=>({...e,open:!1})),r.onClose&&r.onClose()}})]})},u=()=>{let e=(0,t.useContext)(i);if(!e)throw Error("useSnackbar must be used within a SnackbarProvider");return e}},59443:(e,a,r)=>{r.d(a,{default:()=>j});var s=r(95155),t=r(12115),l=r(37129),o=r(23464),n=r(94573),i=r(864),d=r(33613),u=r(38464);let c=(0,r(57515).A)((0,s.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person");var m=r(2582),p=r(26290),b=r(92549),h=r(81787),g=r(58674),x=r(40963),f=r(35695);let v=l.Ik().shape({name:l.Yj().required("Name is required").min(2,"Name must be at least 2 characters"),email:l.Yj().required("Email is required").email("Please enter a valid email address"),mobileNumber:l.Yj().required("Mobile number is required").matches(/^[0-9]{10}$/,"Please enter a valid 10-digit mobile number"),password:l.Yj().when("mode",{is:e=>"create"===e,then:e=>e.required("Password is required").min(6,"Password must be at least 6 characters"),otherwise:e=>e}),confirmPassword:l.Yj().when("mode",{is:e=>"create"===e,then:e=>e.required("Please confirm your password").oneOf([l.KR("password")],"Passwords do not match"),otherwise:e=>e}),modules:l.YO().min(1,"Select at least one module"),status:l.Yj().oneOf(["ACTIVE","INACTIVE"],"Status must be Active or Inactive").required("Status is required"),userRole:l.ai().oneOf([1,2],"Select a user role").required("User role is required")}),y={name:"",email:"",mobileNumber:"",password:"",confirmPassword:"",status:"ACTIVE",userRole:1},j=e=>{let{userId:a,mode:r="create"}=e,{showSnackbar:l}=(0,x.d)(),j=(0,f.useRouter)(),[N,w]=(0,t.useState)(y),[A,C]=(0,t.useState)(!1),[S,_]=(0,t.useState)(!1),[k,P]=(0,t.useState)({}),[E,I]=(0,t.useState)(!1),[q,R]=(0,t.useState)([]),[O,T]=(0,t.useState)([]),[V,U]=(0,t.useState)(!1),[F]=(0,t.useState)([{label:"Active",value:"ACTIVE"},{label:"Inactive",value:"INACTIVE"}]),[Y]=(0,t.useState)([{label:"Admin",value:1},{label:"Staff",value:2}]);(0,t.useEffect)(()=>{try{let e=localStorage.getItem("modules");if(e){let a=JSON.parse(e),r=Array.isArray(a)?a.map(e=>{var a,r,s;let t=null!=(r=null!=(a=e.value)?a:e.label)?r:String(e),l=null!=(s=e.label)?s:t;return"string"==typeof t&&t.endsWith("_module")&&(l=t.replace(/_module$/,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())),{label:l,value:t}}):[];T(r)}else T([])}catch(e){T([])}},[]),(0,t.useEffect)(()=>{"edit"===r&&a&&L(a)},[a,r]);let L=async e=>{U(!0);try{let a=localStorage.getItem("token");if(!a){console.log("Auth token not found. Please login again."),U(!1);return}let r=(await o.A.get("/api/protected/create-customer?customer_uuid=".concat(e),{headers:{"Content-Type":"application/json","x-auth-token":"Bearer ".concat(a)}})).data.data[0];if(w({name:r.customer_name||"",email:r.customer_email||"",mobileNumber:r.customer_mobile||"",password:"",confirmPassword:"",status:r.status||"ACTIVE",userRole:r.customer_role}),r.module&&Array.isArray(r.module))R(r.module.map(e=>{let a=e;return"string"==typeof e&&e.endsWith("_module")&&(a=e.replace(/_module$/,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())),{label:a,value:e}}));else if(r.quotation_module||r.business_card_module){let e=[];r.quotation_module&&e.push({label:"Quotation",value:"quotation_module"}),r.business_card_module&&e.push({label:"Business Card",value:"business_card_module"}),R(e)}}catch(e){console.error("Error fetching user data:",e)}finally{U(!1)}},B=async()=>{try{return await v.validate({...N,modules:q,mode:r},{abortEarly:!1}),P({}),!0}catch(a){let e={};return a.inner&&a.inner.forEach(a=>{"modules"===a.path?e.modules=a.message:e[a.path]=a.message}),P(e),!1}},M=(e,a)=>{w(r=>({...r,[e]:"userRole"===e?Number(a):a})),k[e]&&P(a=>({...a,[e]:""}))},W=()=>{w(y),C(!1),_(!1),R([])},D=async e=>{if(e.preventDefault(),!await B())return void l("Please fix the validation errors","error",4e3);I(!0);let s="";try{let e=localStorage.getItem("user");e&&(s=JSON.parse(e).companyuuid||"")}catch(e){s=""}if("create"===r&&!s){l("Company UUID not found. Please login again.","error",4e3),I(!1);return}let t=localStorage.getItem("token");if(!t){l("Auth token not found. Please login again.","error",4e3),I(!1);return}let n=q.map(e=>e.value),i={customer_name:N.name,customer_email:N.email,customer_mobile:N.mobileNumber,customer_role:N.userRole,module:n,quotation_module:n.includes("quotation_module"),business_card_module:n.includes("business_card_module"),status:N.status};("create"===r||N.password)&&(i.customer_password=N.password),"edit"===r&&(i.customer_country_code="+91");try{let e;e="edit"===r&&a?await o.A.put("/api/protected/create-customer?customer_uuid=".concat(a),i,{headers:{"Content-Type":"application/json","x-auth-token":"Bearer ".concat(t)}}):await o.A.post("/api/protected/create-customer?company_uuid=".concat(s),i,{headers:{"Content-Type":"application/json","x-auth-token":"Bearer ".concat(t)}}),l(e.data.msg,"success",3e3),W(),j.push("/user/users")}catch(e){var d,u;console.error("Error submitting user:",e),l((null==(u=e.response)||null==(d=u.data)?void 0:d.msg)||"Error submitting user","error",4e3)}finally{I(!1)}};return V?(0,s.jsx)("div",{className:"flex justify-center items-center h-40",children:"Loading..."}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4 sm:p-6 lg:p-8",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsx)("div",{}),(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsxs)("button",{type:"button",className:"flex items-center gap-2 text-indigo-600 hover:text-indigo-800 font-semibold",onClick:()=>j.back(),children:[(0,s.jsx)(u.A,{fontSize:"small"}),"Back"]}),(0,s.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-900",children:"edit"===r?"Edit User":"Add New User"})]}),(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:(0,s.jsx)("div",{className:"p-6 sm:p-8",children:(0,s.jsxs)("form",{onSubmit:D,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Name *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:"text",id:"name",value:N.name,onChange:e=>M("name",e.target.value),className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ".concat(k.name?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),placeholder:"Enter name"})]}),k.name&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:k.name})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(m.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:"email",id:"email",value:N.email,onChange:e=>M("email",e.target.value),className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ".concat(k.email?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),disabled:"edit"===r,placeholder:"Enter email address"})]}),k.email&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:k.email})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"mobileNumber",className:"block text-sm font-medium text-gray-700",children:"Mobile Number *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(p.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:"tel",id:"mobileNumber",value:N.mobileNumber,onChange:e=>M("mobileNumber",e.target.value.replace(/\D/g,"")),className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ".concat(k.mobileNumber?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),placeholder:"1234567890",maxLength:10})]}),k.mobileNumber&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:k.mobileNumber})]}),(0,s.jsx)("div",{className:"space-y-2 mt-6",children:(0,s.jsx)(n.A,{id:"role-autocomplete",options:Y,getOptionLabel:e=>e.label,value:Y.find(e=>e.value===N.userRole)||null,onChange:(e,a)=>{a?M("userRole",a.value.toString()):M("userRole","")},renderInput:e=>(0,s.jsx)(i.A,{...e,name:"userRole",label:"User Role",error:!!k.userRole,helperText:k.userRole,placeholder:"Select user role",fullWidth:!0}),renderOption:(e,a)=>(0,t.createElement)("li",{...e,key:a.value,className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{checked:N.userRole===a.value,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]}),disableCloseOnSelect:!0})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:["Password ","create"===r?"*":""]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(b.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:A?"text":"password",id:"password",value:N.password,onChange:e=>M("password",e.target.value),className:"w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ".concat(k.password?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),placeholder:"Enter password"}),(0,s.jsx)("button",{type:"button",onClick:()=>C(e=>!e),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:A?(0,s.jsx)(h.A,{className:"h-5 w-5"}):(0,s.jsx)(g.A,{className:"h-5 w-5"})})]}),k.password&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:k.password})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:["Confirm Password ","create"===r?"*":""]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(b.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:S?"text":"password",id:"confirmPassword",value:N.confirmPassword,onChange:e=>M("confirmPassword",e.target.value),className:"w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ".concat(k.confirmPassword?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),placeholder:"Confirm password"}),(0,s.jsx)("button",{type:"button",onClick:()=>_(e=>!e),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:S?(0,s.jsx)(h.A,{className:"h-5 w-5"}):(0,s.jsx)(g.A,{className:"h-5 w-5"})})]}),k.confirmPassword&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:k.confirmPassword})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(n.A,{multiple:!0,id:"module-autocomplete",options:O,getOptionLabel:e=>e.label,value:q,onChange:(e,a)=>R(a),isOptionEqualToValue:(e,a)=>e.value===a.value,renderInput:e=>(0,s.jsx)(i.A,{...e,name:"modules",label:"Module",error:!!k.modules,helperText:k.modules,placeholder:"Select module(s)",fullWidth:!0}),renderOption:(e,a,r)=>{let{selected:l}=r;return(0,t.createElement)("li",{...e,key:a.value,className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{checked:l,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]})},disableCloseOnSelect:!0})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(n.A,{id:"status-autocomplete",options:F,getOptionLabel:e=>e.label,value:F.find(e=>e.value===N.status)||F[0],onChange:(e,a)=>{a&&M("status",a.value)},renderInput:e=>(0,s.jsx)(i.A,{...e,name:"status",label:"Status",error:!!k.status,helperText:k.status,placeholder:"Select status",fullWidth:!0}),renderOption:(e,a)=>(0,t.createElement)("li",{...e,key:a.value,className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{checked:N.status===a.value,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]}),disableCloseOnSelect:!0})})]}),(0,s.jsxs)("div",{className:"pt-4 flex gap-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{W(),P({}),l("Form cleared","info",2e3)},disabled:E,className:"flex-1 py-3 px-6 rounded-lg font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 border border-gray-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:E,className:"flex-1 flex items-center justify-center gap-2 py-3 px-6 rounded-lg font-medium text-white transition-all duration-200 ".concat(E?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 transform hover:scale-[1.02] shadow-lg hover:shadow-xl"),children:E?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Submitting..."]}):(0,s.jsx)(s.Fragment,{children:"edit"===r?"Update":"Submit"})})]})]})})})]})})}},92549:(e,a,r)=>{r.d(a,{A:()=>l});var s=r(57515),t=r(95155);let l=(0,s.A)((0,t.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1z"}),"Lock")}}]);