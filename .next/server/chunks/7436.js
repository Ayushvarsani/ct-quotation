"use strict";exports.id=7436,exports.ids=[7436],exports.modules={16215:(e,a,r)=>{r.d(a,{A:()=>l});var s=r(23428),t=r(60687);let l=(0,s.A)((0,t.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1z"}),"Lock")},97436:(e,a,r)=>{r.d(a,{default:()=>y});var s=r(60687),t=r(43210),l=r(30485),o=r(51917),i=r(44221),d=r(72318),n=r(12064);let u=(0,r(23428).A)((0,s.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person");var c=r(91270),m=r(25238),p=r(16215),b=r(89463),h=r(75396),x=r(83236),g=r(16189);!function(){var e=Error("Cannot find module 'axios'");throw e.code="MODULE_NOT_FOUND",e}();let f=l.Ik().shape({name:l.Yj().required("Name is required").min(2,"Name must be at least 2 characters"),email:l.Yj().required("Email is required").email("Please enter a valid email address"),mobileNumber:l.Yj().required("Mobile number is required").matches(/^[0-9]{10}$/,"Please enter a valid 10-digit mobile number"),password:l.Yj().when("mode",{is:e=>"create"===e,then:e=>e.required("Password is required").min(6,"Password must be at least 6 characters"),otherwise:e=>e}),confirmPassword:l.Yj().when("mode",{is:e=>"create"===e,then:e=>e.required("Please confirm your password").oneOf([l.KR("password")],"Passwords do not match"),otherwise:e=>e}),modules:l.YO().min(1,"Select at least one module"),status:l.Yj().oneOf(["ACTIVE","INACTIVE"],"Status must be Active or Inactive").required("Status is required"),userRole:l.ai().oneOf([1,2],"Select a user role").required("User role is required")}),v={name:"",email:"",mobileNumber:"",password:"",confirmPassword:"",status:"ACTIVE",userRole:1},y=({userId:e,mode:a="create"})=>{let{showSnackbar:r}=(0,x.d)(),l=(0,g.useRouter)(),[y,N]=(0,t.useState)(v),[j,w]=(0,t.useState)(!1),[_,A]=(0,t.useState)(!1),[C,S]=(0,t.useState)({}),[E,O]=(0,t.useState)(!1),[k,P]=(0,t.useState)([]),[I,q]=(0,t.useState)([]),[R,T]=(0,t.useState)(!1),[U]=(0,t.useState)([{label:"Active",value:"ACTIVE"},{label:"Inactive",value:"INACTIVE"}]),[$]=(0,t.useState)([{label:"Admin",value:1},{label:"Staff",value:2}]);(0,t.useEffect)(()=>{try{let e=localStorage.getItem("modules");if(e){let a=JSON.parse(e),r=Array.isArray(a)?a.map(e=>{let a=e.value??e.label??String(e),r=e.label??a;return"string"==typeof a&&a.endsWith("_module")&&(r=a.replace(/_module$/,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())),{label:r,value:a}}):[];q(r)}else q([])}catch{q([])}},[]),(0,t.useEffect)(()=>{"edit"===a&&e&&F(e)},[e,a]);let F=async e=>{T(!0);try{let a=localStorage.getItem("token");if(!a){console.log("Auth token not found. Please login again."),T(!1);return}let r=(await Object(function(){var e=Error("Cannot find module 'axios'");throw e.code="MODULE_NOT_FOUND",e}())(`/api/protected/create-customer?customer_uuid=${e}`,{headers:{"Content-Type":"application/json","x-auth-token":`Bearer ${a}`}})).data.data[0];if(N({name:r.customer_name||"",email:r.customer_email||"",mobileNumber:r.customer_mobile||"",password:"",confirmPassword:"",status:r.status||"ACTIVE",userRole:r.customer_role}),r.module&&Array.isArray(r.module))P(r.module.map(e=>{let a=e;return"string"==typeof e&&e.endsWith("_module")&&(a=e.replace(/_module$/,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())),{label:a,value:e}}));else if(r.quotation_module||r.business_card_module){let e=[];r.quotation_module&&e.push({label:"Quotation",value:"quotation_module"}),r.business_card_module&&e.push({label:"Business Card",value:"business_card_module"}),P(e)}}catch(e){console.error("Error fetching user data:",e)}finally{T(!1)}},D=async()=>{try{return await f.validate({...y,modules:k,mode:a},{abortEarly:!1}),S({}),!0}catch(a){let e={};return a.inner&&a.inner.forEach(a=>{"modules"===a.path?e.modules=a.message:e[a.path]=a.message}),S(e),!1}},L=(e,a)=>{N(r=>({...r,[e]:"userRole"===e?Number(a):a})),C[e]&&S(a=>({...a,[e]:""}))},V=()=>{N(v),w(!1),A(!1),P([])},M=async s=>{if(s.preventDefault(),!await D())return void r("Please fix the validation errors","error",4e3);O(!0);let t="";try{let e=localStorage.getItem("user");e&&(t=JSON.parse(e).companyuuid||"")}catch{t=""}if("create"===a&&!t){r("Company UUID not found. Please login again.","error",4e3),O(!1);return}let o=localStorage.getItem("token");if(!o){r("Auth token not found. Please login again.","error",4e3),O(!1);return}let i=k.map(e=>e.value),d={customer_name:y.name,customer_email:y.email,customer_mobile:y.mobileNumber,customer_role:y.userRole,module:i,quotation_module:i.includes("quotation_module"),business_card_module:i.includes("business_card_module"),status:y.status};("create"===a||y.password)&&(d.customer_password=y.password),"edit"===a&&(d.customer_country_code="+91");try{let s;s="edit"===a&&e?await Object(function(){var e=Error("Cannot find module 'axios'");throw e.code="MODULE_NOT_FOUND",e}())(`/api/protected/create-customer?customer_uuid=${e}`,d,{headers:{"Content-Type":"application/json","x-auth-token":`Bearer ${o}`}}):await Object(function(){var e=Error("Cannot find module 'axios'");throw e.code="MODULE_NOT_FOUND",e}())(`/api/protected/create-customer?company_uuid=${t}`,d,{headers:{"Content-Type":"application/json","x-auth-token":`Bearer ${o}`}}),r(s.data.msg,"success",3e3),V(),l.push("/user/users")}catch(e){console.error("Error submitting user:",e),r(e.response?.data?.msg||"Error submitting user","error",4e3)}finally{O(!1)}};return R?(0,s.jsx)("div",{className:"flex justify-center items-center h-40",children:"Loading..."}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4 sm:p-6 lg:p-8",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsx)("div",{}),(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsxs)("button",{type:"button",className:"flex items-center gap-2 text-indigo-600 hover:text-indigo-800 font-semibold",onClick:()=>l.back(),children:[(0,s.jsx)(n.A,{fontSize:"small"}),"Back"]}),(0,s.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-900",children:"edit"===a?"Edit User":"Add New User"})]}),(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:(0,s.jsx)("div",{className:"p-6 sm:p-8",children:(0,s.jsxs)("form",{onSubmit:M,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Name *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:"text",id:"name",value:y.name,onChange:e=>L("name",e.target.value),className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${C.name?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"}`,placeholder:"Enter name"})]}),C.name&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:C.name})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(c.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:"email",id:"email",value:y.email,onChange:e=>L("email",e.target.value),className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${C.email?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"}`,disabled:"edit"===a,placeholder:"Enter email address"})]}),C.email&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:C.email})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"mobileNumber",className:"block text-sm font-medium text-gray-700",children:"Mobile Number *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(m.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:"tel",id:"mobileNumber",value:y.mobileNumber,onChange:e=>L("mobileNumber",e.target.value.replace(/\D/g,"")),className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${C.mobileNumber?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"}`,placeholder:"1234567890",maxLength:10})]}),C.mobileNumber&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:C.mobileNumber})]}),(0,s.jsx)("div",{className:"space-y-2 mt-6",children:(0,s.jsx)(o.A,{id:"role-autocomplete",options:$,getOptionLabel:e=>e.label,value:$.find(e=>e.value===y.userRole)||null,onChange:(e,a)=>{a?L("userRole",a.value.toString()):L("userRole","")},renderInput:e=>(0,s.jsx)(i.A,{...e,name:"userRole",label:"User Role",error:!!C.userRole,helperText:C.userRole,placeholder:"Select user role",fullWidth:!0}),renderOption:(e,a)=>(0,t.createElement)("li",{...e,key:a.value,className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{checked:y.userRole===a.value,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]}),disableCloseOnSelect:!0})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:["Password ","create"===a?"*":""]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(p.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:j?"text":"password",id:"password",value:y.password,onChange:e=>L("password",e.target.value),className:`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${C.password?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"}`,placeholder:"Enter password"}),(0,s.jsx)("button",{type:"button",onClick:()=>w(e=>!e),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:j?(0,s.jsx)(b.A,{className:"h-5 w-5"}):(0,s.jsx)(h.A,{className:"h-5 w-5"})})]}),C.password&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:C.password})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:["Confirm Password ","create"===a?"*":""]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(p.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:_?"text":"password",id:"confirmPassword",value:y.confirmPassword,onChange:e=>L("confirmPassword",e.target.value),className:`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${C.confirmPassword?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"}`,placeholder:"Confirm password"}),(0,s.jsx)("button",{type:"button",onClick:()=>A(e=>!e),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:_?(0,s.jsx)(b.A,{className:"h-5 w-5"}):(0,s.jsx)(h.A,{className:"h-5 w-5"})})]}),C.confirmPassword&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:C.confirmPassword})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(o.A,{multiple:!0,id:"module-autocomplete",options:I,getOptionLabel:e=>e.label,value:k,onChange:(e,a)=>P(a),isOptionEqualToValue:(e,a)=>e.value===a.value,renderInput:e=>(0,s.jsx)(i.A,{...e,name:"modules",label:"Module",error:!!C.modules,helperText:C.modules,placeholder:"Select module(s)",fullWidth:!0}),renderOption:(e,a,{selected:r})=>(0,t.createElement)("li",{...e,key:a.value,className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{checked:r,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]}),disableCloseOnSelect:!0})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(o.A,{id:"status-autocomplete",options:U,getOptionLabel:e=>e.label,value:U.find(e=>e.value===y.status)||U[0],onChange:(e,a)=>{a&&L("status",a.value)},renderInput:e=>(0,s.jsx)(i.A,{...e,name:"status",label:"Status",error:!!C.status,helperText:C.status,placeholder:"Select status",fullWidth:!0}),renderOption:(e,a)=>(0,t.createElement)("li",{...e,key:a.value,className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{checked:y.status===a.value,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]}),disableCloseOnSelect:!0})})]}),(0,s.jsxs)("div",{className:"pt-4 flex gap-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{V(),S({}),r("Form cleared","info",2e3)},disabled:E,className:"flex-1 py-3 px-6 rounded-lg font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 border border-gray-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:E,className:`flex-1 flex items-center justify-center gap-2 py-3 px-6 rounded-lg font-medium text-white transition-all duration-200 ${E?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 transform hover:scale-[1.02] shadow-lg hover:shadow-xl"}`,children:E?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Submitting..."]}):(0,s.jsx)(s.Fragment,{children:"edit"===a?"Update":"Submit"})})]})]})})})]})})}}};