"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3119],{40963:(e,a,t)=>{t.d(a,{n:()=>d,d:()=>c});var s=t(95155),l=t(12115),r=t(35726),o=t(9665);let i=e=>{let{open:a,message:t,severity:l="info",duration:i=2e3,onClose:n}=e;return(0,s.jsx)(r.A,{open:a,autoHideDuration:i,onClose:n,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,s.jsx)(o.A,{onClose:n,severity:l,variant:"filled",children:t})})},n=(0,l.createContext)(void 0),d=e=>{let{children:a}=e,[t,r]=(0,l.useState)({open:!1,message:"",severity:"info",duration:2e3,onClose:void 0});return(0,s.jsxs)(n.Provider,{value:{showSnackbar:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;r({open:!0,message:e,severity:a,duration:t,onClose:s})}},children:[a,(0,s.jsx)(i,{open:t.open,message:t.message,severity:t.severity,duration:t.duration,onClose:()=>{r(e=>({...e,open:!1})),t.onClose&&t.onClose()}})]})},c=()=>{let e=(0,l.useContext)(n);if(!e)throw Error("useSnackbar must be used within a SnackbarProvider");return e}},73119:(e,a,t)=>{t.d(a,{default:()=>A});var s=t(95155),l=t(12115),r=t(62177),o=t(62461),i=t(37129),n=t(76408),d=t(35695),c=t(69164),m=t(2582),u=t(58674),p=t(81787),x=t(26290),h=t(22549),g=t(864),b=t(94573),y=t(33613),v=t(83729),j=t(4915),f=t(38464),N=t(23464),w=t(40963),_=t(30832),k=t.n(_);let C=i.Ik({companyName:i.Yj().required("Company name is required"),email:i.Yj().email("Invalid email").required("Email is required"),password:i.Yj().when("$mode",{is:"create",then:e=>e.required("Password is required").min(8,"Password must be at least 8 characters"),otherwise:e=>e.notRequired().test("min-if-filled","Password must be at least 8 characters",e=>!e||e.length>=8)}),mobileNo:i.Yj().required("Mobile number is required").matches(/^[0-9]{10}$/,"Please enter a valid 10-digit mobile number"),defaultMessageNumber:i.Yj().notRequired().test("is-valid-phone","Please enter a valid 10-digit mobile number",function(e){return!e||/^[0-9]{10}$/.test(e)}),startDate:i.Yj().required("Start date is required"),endDate:i.Yj().required("End date is required"),modules:i.YO().of(i.Yj().oneOf(["quotation_module","visit"])).min(1,"Select at least one module").required("Module is required"),status:i.Yj().oneOf(["ACTIVE","INACTIVE"],"Status must be Active or Inactive").required("Status is required")}).required(),A=e=>{var a,t,i,_,A,q,P;let{mode:S,companyId:E}=e,I=(0,d.useRouter)(),{showSnackbar:D}=(0,w.d)(),[T,M]=(0,l.useState)(!1),[O,Y]=(0,l.useState)({product:!0,size:!0,series:!1,category:!1,finish:!1,pcsPerBox:!1,sqFtPerBox:!1,weight:!1,pre:!1,std:!1,com:!1,eco:!1}),[B,z]=(0,l.useState)([]),[W,V]=(0,l.useState)(!1),[F,L]=(0,l.useState)([]),[R]=(0,l.useState)([{label:"Active",value:"ACTIVE"},{label:"Inactive",value:"INACTIVE"}]),H=e=>{Y(a=>({...a,[e]:!a[e]}))},{register:Q,handleSubmit:$,setValue:U,watch:G,reset:J,formState:{errors:K,isSubmitting:X}}=(0,r.mN)({resolver:(0,o.t)(C),context:{mode:S},defaultValues:{modules:[],status:"ACTIVE"}}),Z={product:"product_name",size:"product_size",series:"product_series",category:"product_category",finish:"product_finish",pcsPerBox:"product_pieces_per_box",sqFtPerBox:"product_sq_ft_box",weight:"product_weight"};(0,l.useEffect)(()=>{try{let e=localStorage.getItem("modules");if(e){let a=JSON.parse(e),t={quotation_module:"Quotation",business_card_module:"Business Card"},s=Array.isArray(a)?a.map(e=>{var a,s;let l=null!=(s=null!=(a=e.value)?a:e.label)?s:String(e);return{label:t[l]||l,value:l}}):[];L(s)}else L([{label:"Quotation",value:"quotation_module"},{label:"Business Card",value:"business_card_module"}])}catch(e){L([{label:"Quotation",value:"quotation_module"},{label:"Business Card",value:"business_card_module"}])}},[]);let ee=async()=>{try{V(!0);let e=localStorage.getItem("admin_jwt_token"),a=(await N.A.get("/api/protected/create-company?company_uuid=".concat(E),{headers:{"x-auth-token":"Bearer ".concat(e)}})).data.data;J({companyName:a.company_name,email:a.company_email,password:a.company_password,mobileNo:a.company_mobile,defaultMessageNumber:a.company_message_number,startDate:k()(a.start_date).format("YYYY-MM-DD"),endDate:k()(a.end_date).format("YYYY-MM-DD"),status:a.status});let t={...es};Object.entries(Z).forEach(e=>{let[s,l]=e;a[l]&&(t[s]=a[l])}),el(t);let s=[];if(a.quotation_module){let e=F.find(e=>"quotation_module"===e.value);e&&s.push(e)}if(a.business_card_module){let e=F.find(e=>"business_card_module"===e.value);e&&s.push(e)}if(z(s),U("modules",s.map(e=>e.value)),!0===a.quotation_module){let e={...O};Object.entries(Z).forEach(t=>{let[s,l]=t;a[l]&&(e[s]=!0)}),a.pre_grade&&(e.pre=!0),a.std_grade&&(e.std=!0),a.com_grade&&(e.com=!0),a.eco_grade&&(e.eco=!0),Y(e)}}catch(e){console.error("Error fetching company data:",e),D("Failed to load company data","error")}finally{V(!1)}};(0,l.useEffect)(()=>{"edit"===S&&E&&F.length>0&&ee()},[S,E,F]);let ea=async e=>{try{let a=e.modules.includes("quotation_module"),t={};a&&(Object.entries(Z).forEach(e=>{let[a,s]=e;O[a]&&(t[s]=es[a])}),t.pre_grade=O.pre,t.com_grade=O.com,t.eco_grade=O.eco,t.std_grade=O.std);let s={company_name:e.companyName,company_email:e.email,company_mobile:e.mobileNo,...e.password&&{company_password:e.password},module:e.modules,start_date:e.startDate,end_date:e.endDate,...e.defaultMessageNumber&&{company_message_number:e.defaultMessageNumber},status:e.status,...a&&t},l=localStorage.getItem("admin_jwt_token");if("create"===S){let e=await N.A.post("/api/protected/create-company",s,{headers:{"x-auth-token":"Bearer ".concat(l),"Content-Type":"application/json"}});D(e.data.msg,"success")}else{let e=await N.A.put("/api/protected/create-company?company_uuid=".concat(E),s,{headers:{"x-auth-token":"Bearer ".concat(l),"Content-Type":"application/json"}});D(e.data.msg,"success")}I.push("/admin/companies")}catch(e){var a,t;D((null==(t=e.response)||null==(a=t.data)?void 0:a.msg)||"An error occurred","error"),console.error("Error saving company:",e)}},et=[{key:"product",label:"Product"},{key:"size",label:"Size"},{key:"series",label:"Series"},{key:"category",label:"Category"},{key:"finish",label:"Finish"},{key:"pcsPerBox",label:"Pcs per box"},{key:"sqFtPerBox",label:"Sq.ft per box"},{key:"weight",label:"Weight"}],[es,el]=(0,l.useState)(Object.fromEntries(et.map(e=>[e.key,e.label]))),er=B.some(e=>"quotation_module"===e.value);return W?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-6 lg:p-8",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl p-6 sm:p-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin h-8 w-8 text-indigo-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("span",{className:"ml-2 text-lg",children:"Loading company data..."})]})})})}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-6 lg:p-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("button",{type:"button",className:"flex items-center gap-2 text-indigo-600 hover:text-indigo-800 font-semibold mb-4",onClick:()=>I.back(),children:[(0,s.jsx)(f.A,{fontSize:"small"}),"Back"]}),(0,s.jsx)(n.P.div,{children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-6 sm:p-8",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(c.A,{className:"w-8 h-8 text-white"})}),(0,s.jsx)("h1",{className:"text-2xl sm:text-2xl font-bold text-gray-900 mb-2",children:"create"===S?"Create New Company":"Edit Company"})]}),(0,s.jsxs)("form",{onSubmit:$(ea),className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(g.A,{...Q("companyName"),label:"Company Name",placeholder:"Enter company name",error:!!K.companyName,helperText:null==(a=K.companyName)?void 0:a.message,fullWidth:!0,InputProps:{endAdornment:(0,s.jsx)(c.A,{className:"text-gray-400"})}})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(g.A,{...Q("email"),label:"Email",placeholder:"Enter email",error:!!K.email,helperText:null==(t=K.email)?void 0:t.message,fullWidth:!0,InputProps:{endAdornment:(0,s.jsx)(m.A,{className:"text-gray-400"})},disabled:"edit"===S})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(g.A,{...Q("password"),label:"create"===S?"Password":"Password ",type:T?"text":"password",placeholder:"create"===S?"Create a strong password":"Leave blank to keep current password",error:!!K.password,helperText:null==(i=K.password)?void 0:i.message,fullWidth:!0,InputProps:{endAdornment:(0,s.jsx)("button",{type:"button",onClick:()=>M(!T),style:{background:"none",border:"none",padding:0,margin:0,cursor:"pointer"},children:T?(0,s.jsx)(p.A,{className:"text-gray-400 hover:text-gray-600"}):(0,s.jsx)(u.A,{className:"text-gray-400 hover:text-gray-600"})})}})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(g.A,{...Q("mobileNo"),label:"Mobile Number",type:"tel",placeholder:"Enter 10-digit mobile number",error:!!K.mobileNo,helperText:null==(_=K.mobileNo)?void 0:_.message,fullWidth:!0,InputProps:{endAdornment:(0,s.jsx)(x.A,{className:"text-gray-400"})}})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(g.A,{...Q("defaultMessageNumber"),label:"Default Message Number",type:"tel",placeholder:"Enter 10-digit default message number",InputProps:{endAdornment:(0,s.jsx)(h.A,{className:"text-gray-400"})},error:!!K.defaultMessageNumber,helperText:null==(A=K.defaultMessageNumber)?void 0:A.message,fullWidth:!0})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(b.A,{multiple:!0,id:"module-autocomplete",options:F,getOptionLabel:e=>e.label,value:B,onChange:(e,a)=>{z(a),U("modules",a.map(e=>e.value),{shouldValidate:!0})},isOptionEqualToValue:(e,a)=>e.value===a.value,renderInput:e=>{var a;return(0,s.jsx)(g.A,{...e,name:"modules",label:"Module",error:!!K.modules,helperText:null==(a=K.modules)?void 0:a.message,placeholder:"Select module(s)",fullWidth:!0})},renderOption:(e,a,t)=>{let{selected:r}=t,{...o}=e;return(0,l.createElement)("li",{...o,key:"module-".concat(a.value||a.label),className:"flex items-center gap-2",children:[(0,s.jsx)(y.A,{checked:r,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]})},disableCloseOnSelect:!0})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(b.A,{id:"status-autocomplete",options:R,getOptionLabel:e=>e.label,value:R.find(e=>e.value===G("status"))||R[0],onChange:(e,a)=>{a&&U("status",a.value,{shouldValidate:!0})},renderInput:e=>{var a;return(0,s.jsx)(g.A,{...e,name:"status",label:"Status",error:!!K.status,helperText:null==(a=K.status)?void 0:a.message,placeholder:"Select status",fullWidth:!0})},renderOption:(e,a)=>{let t=G("status"),{...r}=e;return(0,l.createElement)("li",{...r,key:"status-".concat(a.value||a.label),className:"flex items-center gap-2",children:[(0,s.jsx)(y.A,{checked:t===a.value,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]})},disableCloseOnSelect:!0})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(g.A,{...Q("startDate"),label:"Start Date",type:"date",InputLabelProps:{shrink:!0},error:!!K.startDate,helperText:null==(q=K.startDate)?void 0:q.message,fullWidth:!0})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(g.A,{...Q("endDate"),label:"End Date",type:"date",InputLabelProps:{shrink:!0},error:!!K.endDate,helperText:null==(P=K.endDate)?void 0:P.message,fullWidth:!0})})]})]}),er&&(0,s.jsxs)("div",{className:"mt-8",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Field Permissions"}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg overflow-hidden border border-gray-200 grid md:grid-cols-2",children:[(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Field Name"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Permission"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200",children:et.map(e=>(0,s.jsxs)("tr",{className:"bg-white hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:(0,s.jsx)(v.A,{title:e.key,arrow:!0,children:(0,s.jsx)(g.A,{value:es[e.key],onChange:a=>el({...es,[e.key]:a.target.value}),size:"small",variant:"outlined"})})}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)(j.A,{control:(0,s.jsx)(y.A,{checked:O[e.key],onChange:()=>H(e.key),color:"primary"}),label:""})})]},e.key))})]}),(0,s.jsxs)("table",{className:"w-full md:border-l-2 border-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Grade Name"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Permission"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200",children:[{key:"pre",label:"PRE"},{key:"std",label:"STD"},{key:"com",label:"COM"},{key:"eco",label:"ECO"}].map(e=>(0,s.jsxs)("tr",{className:"bg-white hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.label}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)(j.A,{control:(0,s.jsx)(y.A,{checked:O[e.key],onChange:()=>H(e.key),color:"primary"}),label:""})})]},e.key))})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-3 sm:gap-4 pt-6 sm:pt-8",children:[(0,s.jsx)(n.P.button,{type:"button",onClick:()=>I.back(),whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 sm:px-6 py-2.5 sm:py-3 text-sm border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-200 transition-all duration-200",children:"Cancel"}),(0,s.jsx)(n.P.button,{type:"submit",disabled:X,whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 sm:px-6 py-2.5 sm:py-3 text-sm bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-lg hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg",children:X?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("span",{className:"text-sm",children:"create"===S?"Creating Company...":"Updating Company..."})]}):"create"===S?"Create Company":"Update Company"})]})]})]})})]})})}}}]);