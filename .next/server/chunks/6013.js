"use strict";exports.id=6013,exports.ids=[6013],exports.modules={56013:(e,a,s)=>{s.d(a,{default:()=>w});var t=s(60687),r=s(43210),l=s(27605),o=s(10268),i=s(30485),d=s(26001),n=s(16189),c=s(12818),m=s(91270),u=s(75396),p=s(89463),x=s(25238),h=s(50453),b=s(44221),g=s(51917),y=s(72318),j=s(60042),f=s(83487),N=s(12064);!function(){var e=Error("Cannot find module 'axios'");throw e.code="MODULE_NOT_FOUND",e}();var v=s(83236);!function(){var e=Error("Cannot find module 'dayjs'");throw e.code="MODULE_NOT_FOUND",e}();let _=i.Ik({companyName:i.Yj().required("Company name is required"),email:i.Yj().email("Invalid email").required("Email is required"),password:i.Yj().required("Password is required").min(8,"Password must be at least 8 characters"),mobileNo:i.Yj().required("Mobile number is required").matches(/^[0-9]{10}$/,"Please enter a valid 10-digit mobile number"),defaultMessageNumber:i.Yj().required("Default message number is required").matches(/^[0-9]{10}$/,"Please enter a valid 10-digit mobile number"),startDate:i.Yj().required("Start date is required"),endDate:i.Yj().required("End date is required"),modules:i.YO().of(i.Yj().oneOf(["quotation_module","visit"])).min(1,"Select at least one module").required("Module is required"),status:i.Yj().oneOf(["ACTIVE","INACTIVE"],"Status must be Active or Inactive").required("Status is required")}).required(),w=({mode:e,companyId:a})=>{let s=(0,n.useRouter)(),{showSnackbar:i}=(0,v.d)(),[w,C]=(0,r.useState)(!1),[k,A]=(0,r.useState)({product:!0,size:!0,series:!1,category:!1,finish:!1,pcsPerBox:!1,sqFtPerBox:!1,weight:!1,pre:!1,std:!1,com:!1,eco:!1}),[O,E]=(0,r.useState)([]),[D,q]=(0,r.useState)(!1),[P,S]=(0,r.useState)([]),[T]=(0,r.useState)([{label:"Active",value:"ACTIVE"},{label:"Inactive",value:"INACTIVE"}]),I=e=>{A(a=>({...a,[e]:!a[e]}))},{register:M,handleSubmit:Y,setValue:U,watch:B,reset:F,formState:{errors:L,isSubmitting:W}}=(0,l.mN)({resolver:(0,o.t)(_),defaultValues:{modules:[],status:"ACTIVE"}}),z={product:"product_name",size:"product_size",series:"product_series",category:"product_category",finish:"product_finish",pcsPerBox:"product_pieces_per_box",sqFtPerBox:"product_sq_ft_box",weight:"product_weight"};(0,r.useEffect)(()=>{try{let e=localStorage.getItem("modules");if(e){let a=JSON.parse(e),s={quotation_module:"Quotation",business_card_module:"Business Card"},t=Array.isArray(a)?a.map(e=>{let a=e.value??e.label??String(e);return{label:s[a]||a,value:a}}):[];S(t)}else S([{label:"Quotation",value:"quotation_module"},{label:"Business Card",value:"business_card_module"}])}catch{S([{label:"Quotation",value:"quotation_module"},{label:"Business Card",value:"business_card_module"}])}},[]);let V=async()=>{try{q(!0);let e=localStorage.getItem("admin_jwt_token"),s=(await Object(function(){var e=Error("Cannot find module 'axios'");throw e.code="MODULE_NOT_FOUND",e}())(`/api/protected/create-company?company_uuid=${a}`,{headers:{"x-auth-token":`Bearer ${e}`}})).data.data;F({companyName:s.company_name,email:s.company_email,password:s.company_password,mobileNo:s.company_mobile,defaultMessageNumber:s.company_message_number,startDate:Object(function(){var e=Error("Cannot find module 'dayjs'");throw e.code="MODULE_NOT_FOUND",e}())(s.start_date).format("YYYY-MM-DD"),endDate:Object(function(){var e=Error("Cannot find module 'dayjs'");throw e.code="MODULE_NOT_FOUND",e}())(s.end_date).format("YYYY-MM-DD"),status:s.status});let t={...R};Object.entries(z).forEach(([e,a])=>{s[a]&&(t[e]=s[a])}),Q(t);let r=[];if(s.quotation_module){let e=P.find(e=>"quotation_module"===e.value);e&&r.push(e)}if(s.business_card_module){let e=P.find(e=>"business_card_module"===e.value);e&&r.push(e)}if(E(r),U("modules",r.map(e=>e.value)),!0===s.quotation_module){let e={...k};Object.entries(z).forEach(([a,t])=>{s[t]&&(e[a]=!0)}),s.pre_grade&&(e.pre=!0),s.std_grade&&(e.std=!0),s.com_grade&&(e.com=!0),s.eco_grade&&(e.eco=!0),A(e)}}catch(e){console.error("Error fetching company data:",e),i("Failed to load company data","error")}finally{q(!1)}};(0,r.useEffect)(()=>{"edit"===e&&a&&P.length>0&&V()},[e,a,P]);let $=async t=>{try{let r=t.modules.includes("quotation_module"),l={};r&&(Object.entries(z).forEach(([e,a])=>{k[e]&&(l[a]=R[e])}),l.pre_grade=k.pre,l.com_grade=k.com,l.eco_grade=k.eco,l.std_grade=k.std);let o={company_name:t.companyName,company_email:t.email,company_mobile:t.mobileNo,company_password:t.password,module:t.modules,start_date:t.startDate,end_date:t.endDate,company_message_number:t.defaultMessageNumber,status:t.status,...r&&l},d=localStorage.getItem("admin_jwt_token");if("create"===e){let e=await Object(function(){var e=Error("Cannot find module 'axios'");throw e.code="MODULE_NOT_FOUND",e}())("/api/protected/create-company",o,{headers:{"x-auth-token":`Bearer ${d}`,"Content-Type":"application/json"}});i(e.data.msg,"success")}else{let e=await Object(function(){var e=Error("Cannot find module 'axios'");throw e.code="MODULE_NOT_FOUND",e}())(`/api/protected/create-company?company_uuid=${a}`,o,{headers:{"x-auth-token":`Bearer ${d}`,"Content-Type":"application/json"}});i(e.data.msg,"success")}s.push("/admin/companies")}catch(e){i(e.response?.data?.msg||"An error occurred","error"),console.error("Error saving company:",e)}},H=[{key:"product",label:"Product"},{key:"size",label:"Size"},{key:"series",label:"Series"},{key:"category",label:"Category"},{key:"finish",label:"Finish"},{key:"pcsPerBox",label:"Pcs per box"},{key:"sqFtPerBox",label:"Sq.ft per box"},{key:"weight",label:"Weight"}],[R,Q]=(0,r.useState)(Object.fromEntries(H.map(e=>[e.key,e.label]))),G=O.some(e=>"quotation_module"===e.value);return D?(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-6 lg:p-8",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl p-6 sm:p-8",children:(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsxs)("svg",{className:"animate-spin h-8 w-8 text-indigo-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{className:"ml-2 text-lg",children:"Loading company data..."})]})})})}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-6 lg:p-8",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("button",{type:"button",className:"flex items-center gap-2 text-indigo-600 hover:text-indigo-800 font-semibold mb-4",onClick:()=>s.back(),children:[(0,t.jsx)(N.A,{fontSize:"small"}),"Back"]}),(0,t.jsx)(d.P.div,{children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-6 sm:p-8",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(c.A,{className:"w-8 h-8 text-white"})}),(0,t.jsx)("h1",{className:"text-2xl sm:text-2xl font-bold text-gray-900 mb-2",children:"create"===e?"Create New Company":"Edit Company"})]}),(0,t.jsxs)("form",{onSubmit:Y($),className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(b.A,{...M("companyName"),label:"Company Name",placeholder:"Enter company name",error:!!L.companyName,helperText:L.companyName?.message,fullWidth:!0,InputProps:{endAdornment:(0,t.jsx)(c.A,{className:"text-gray-400"})}})}),(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(b.A,{...M("email"),label:"Email",placeholder:"Enter email",error:!!L.email,helperText:L.email?.message,fullWidth:!0,InputProps:{endAdornment:(0,t.jsx)(m.A,{className:"text-gray-400"})},disabled:"edit"===e})}),(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(b.A,{...M("password"),label:"Password",type:w?"text":"password",placeholder:"Create a strong password",error:!!L.password,helperText:L.password?.message,fullWidth:!0,InputProps:{endAdornment:(0,t.jsx)("button",{type:"button",onClick:()=>C(!w),style:{background:"none",border:"none",padding:0,margin:0,cursor:"pointer"},children:w?(0,t.jsx)(p.A,{className:"text-gray-400 hover:text-gray-600"}):(0,t.jsx)(u.A,{className:"text-gray-400 hover:text-gray-600"})})}})}),(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(b.A,{...M("mobileNo"),label:"Mobile Number",type:"tel",placeholder:"Enter 10-digit mobile number",error:!!L.mobileNo,helperText:L.mobileNo?.message,fullWidth:!0,InputProps:{endAdornment:(0,t.jsx)(x.A,{className:"text-gray-400"})}})}),(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(b.A,{...M("defaultMessageNumber"),label:"Default Message Number",type:"tel",placeholder:"Enter default message number",InputProps:{endAdornment:(0,t.jsx)(h.A,{className:"text-gray-400"})},error:!!L.defaultMessageNumber,helperText:L.defaultMessageNumber?.message,fullWidth:!0})}),(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(g.A,{multiple:!0,id:"module-autocomplete",options:P,getOptionLabel:e=>e.label,value:O,onChange:(e,a)=>{E(a),U("modules",a.map(e=>e.value),{shouldValidate:!0})},isOptionEqualToValue:(e,a)=>e.value===a.value,renderInput:e=>(0,t.jsx)(b.A,{...e,name:"modules",label:"Module",error:!!L.modules,helperText:L.modules?.message,placeholder:"Select module(s)",fullWidth:!0}),renderOption:(e,a,{selected:s})=>{let{...l}=e;return(0,r.createElement)("li",{...l,key:`module-${a.value||a.label}`,className:"flex items-center gap-2",children:[(0,t.jsx)(y.A,{checked:s,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]})},disableCloseOnSelect:!0})}),(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(g.A,{id:"status-autocomplete",options:T,getOptionLabel:e=>e.label,value:T.find(e=>e.value===B("status"))||T[0],onChange:(e,a)=>{a&&U("status",a.value,{shouldValidate:!0})},renderInput:e=>(0,t.jsx)(b.A,{...e,name:"status",label:"Status",error:!!L.status,helperText:L.status?.message,placeholder:"Select status",fullWidth:!0}),renderOption:(e,a)=>{let s=B("status"),{...l}=e;return(0,r.createElement)("li",{...l,key:`status-${a.value||a.label}`,className:"flex items-center gap-2",children:[(0,t.jsx)(y.A,{checked:s===a.value,tabIndex:-1,disableRipple:!0,inputProps:{"aria-label":a.label}}),a.label]})},disableCloseOnSelect:!0})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(b.A,{...M("startDate"),label:"Start Date",type:"date",InputLabelProps:{shrink:!0},error:!!L.startDate,helperText:L.startDate?.message,fullWidth:!0})}),(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(b.A,{...M("endDate"),label:"End Date",type:"date",InputLabelProps:{shrink:!0},error:!!L.endDate,helperText:L.endDate?.message,fullWidth:!0})})]})]}),G&&(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Field Permissions"}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg overflow-hidden border border-gray-200 grid md:grid-cols-2",children:[(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-gray-100",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Field Name"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Permission"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200",children:H.map(e=>(0,t.jsxs)("tr",{className:"bg-white hover:bg-gray-50 transition-colors",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:(0,t.jsx)(j.A,{title:e.key,arrow:!0,children:(0,t.jsx)(b.A,{value:R[e.key],onChange:a=>Q({...R,[e.key]:a.target.value}),size:"small",variant:"outlined"})})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(f.A,{control:(0,t.jsx)(y.A,{checked:k[e.key],onChange:()=>I(e.key),color:"primary"}),label:""})})]},e.key))})]}),(0,t.jsxs)("table",{className:"w-full md:border-l-2 border-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-100",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Grade Name"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Permission"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200",children:[{key:"pre",label:"PRE"},{key:"std",label:"STD"},{key:"com",label:"COM"},{key:"eco",label:"ECO"}].map(e=>(0,t.jsxs)("tr",{className:"bg-white hover:bg-gray-50 transition-colors",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.label}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(f.A,{control:(0,t.jsx)(y.A,{checked:k[e.key],onChange:()=>I(e.key),color:"primary"}),label:""})})]},e.key))})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-3 sm:gap-4 pt-6 sm:pt-8",children:[(0,t.jsx)(d.P.button,{type:"button",onClick:()=>s.back(),whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 sm:px-6 py-2.5 sm:py-3 text-sm border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-200 transition-all duration-200",children:"Cancel"}),(0,t.jsx)(d.P.button,{type:"submit",disabled:W,whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 sm:px-6 py-2.5 sm:py-3 text-sm bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-lg hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg",children:W?(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{className:"text-sm",children:"create"===e?"Creating Company...":"Updating Company..."})]}):"create"===e?"Create Company":"Update Company"})]})]})]})})]})})}}};